machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker pull node:8.1.2
    - rm -rf node_modules
    - rm -rf build
    - docker build -t suasvacinas-ci .

test:
  override:
    # figure out how to run tests before
    # npm run test
    # npm run e2e
    - docker run --env FIREBASE_TOKEN=$FIREBASE_TOKEN --env SHA=$CIRCLE_SHA1 suasvacinas-ci bash -c "sed -i \"s/<script src='build/main.js'></script>/<script src='build/main.js?$SHA'></script>/g\" build/index.html && npm run deploy-firebase"
