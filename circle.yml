machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker pull node:8.1.2
    - rm -rf node_modules
    - rm -rf build
    - docker build -t suasvacinas-ci .

test:
  override:
    # figure out how to run tests before
    # npm run test
    # npm run e2e
    - docker run --env FIREBASE_TOKEN=$FIREBASE_TOKEN --env SHA=$CIRCLE_SHA1 suasvacinas-ci bash -c "env && cat www/index.html && echo 'OKOKO' && sed -i \"s/<script src='build\/main.js'><\/script>/<script src='build\/main.js?$HOSTNAME'><\/script>/g\" www/index.html && cat www/index.html && echo '2222222222222222' && npm run deploy-firebase"
